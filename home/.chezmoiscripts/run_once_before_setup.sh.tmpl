{{- /* Required dependencies */ -}}
{{- $formula := list "curl" "git" "jq" "mas" "wget" -}}
{{- $casks := list "1password-cli" -}}

#!/usr/bin/env bash

{{/* Include external functions */}}
{{ template "install-homebrew.tmpl" . }}
{{ template "setup-1password.tmpl" . }}


function homebrew_postinstall() {
  echo "Running Homebrew post installation steps..."

  # Setup Homebrew in shell environment
  echo "Setup current environment..."
  eval "$($(brew --prefix)/bin/brew shellenv)"

  # Install required dependencies
  echo "Installing required dependencies..."
  brew install {{ $formula | sortAlpha | uniq | join " " }}
  brew install --cask {{ $casks | sortAlpha | uniq | join " " }}

}

# https://github.com/pyenv/pyenv#automatic-installer
function install_pyenv() {
  echo "Installing pyenv..."
  curl https://pyenv.run | bash
}

# Stop script on error
set -euo pipefail

# Install Homebrew
install_homebrew
homebrew_postinstall

# Install pyenv
install_pyenv

# Setup 1Password
setup_1password
